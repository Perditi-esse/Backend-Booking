
## Endpoints:

### 1. **Create a New Booking**
- **Endpoint:** `/bookings/{transaction_id}/`
- **Method:** POST
- **URL Example:** `/bookings/txn12345/`
- **Payload Example:**
```json
{
  "show_id": 1,
  "customer_id": 123,
  "seats": "A1,A2,A3",
  "amount": 1500
}
```
- **Response Example:**
```json
{
  "id": 1,
  "show_id": 1,
  "customer_id": 123,
  "seats": "A1,A2,A3",
  "amount": 1500,
  "is_paid": false,
  "is_used": false,
  "datetime": "2023-10-20T14:30:00"
}
```

### 2. **Cancel a Booking (and process a refund if paid)**
- **Endpoint:** `/bookings/{booking_id}/{transaction_id}`
- **Method:** DELETE
- **URL Example:** `/bookings/1/txn12345`
- **Response Example:** (Same as the create booking response)

### 3. **Pay for a Booking**
- **Endpoint:** `/bookings/{booking_id}/pay/{transaction_id}`
- **Method:** PUT
- **URL Example:** `/bookings/1/pay/txn12345`
- **Response:** PDF file of the ticket

### 4. **Validate a Booking/Ticket as Used**
- **Endpoint:** `/bookings/{booking_id}/validate/{transaction_id}`
- **Method:** PUT
- **URL Example:** `/bookings/1/validate/txn12345`
- **Response Example:** (Same as the create booking response)

### 5. **Inform All Users with a Booking for a Specific Show about Its Cancellation and Refund**
- **Endpoint:** `/shows/{show_id}/cancel/{transaction_id}`
- **Method:** PUT
- **URL Example:** `/shows/1/cancel/txn12345`
- **Response Example:** `"10 users affected and notified"`

### 6. **Get a Booking by ID**
- **Endpoint:** `/bookings/{booking_id}/`
- **Method:** GET
- **URL Example:** `/bookings/1/`
- **Response Example:** (Same as the create booking response)

### 7. **Get All Bookings**
- **Endpoint:** `/bookings/all`
- **Method:** GET
- **Response Example:** 
```json
[
  {
    "id": 1,
    "show_id": 1,
    "customer_id": 123,
    "seats": "A1,A2,A3",
    "amount": 1500,
    "is_paid": true,
    "is_used": false,
    "datetime": "2023-10-20T14:30:00"
  },
  ... (more bookings)
]
```

### 8. **Get Bookings by User ID**
- **Endpoint:** `/bookings/user/{user_id}/`
- **Method:** GET
- **URL Example:** `/bookings/user/123/`
- **Response Example:** (List of bookings in the format of create booking response)

### 9. **Get All Bookings for a Show**
- **Endpoint:** `/bookings/show/{show_id}/`
- **Method:** GET
- **URL Example:** `/bookings/show/1/`
- **Response Example:** (List of bookings in the format of create booking response)

### 10. **Test Endpoint**
- **Endpoint:** `/hello`
- **Method:** GET
- **Response:** `"Hello World!"`

## Idempotency:
- **Transaction ID:** A unique identifier generated by the sender for transaction-related requests.
- **Idempotency Key:** Generated using `get_idempotency_key()` function for outbound transactions, ensuring that the request is processed only once. A check is performed using `check_idempotency_key()` function for inbound transactions to ensure idempotency.

## Data Format:
- All data sent and received is in JSON format unless specified otherwise (like the PDF ticket).
- The correct data structure and format should be maintained as illustrated in the examples above.

This detailed documentation aims to provide a clear understanding of how to interact with the Booking API, ensuring accurate and idempotent transactions.